Last week, we faced a critical issue in our log processing pipeline. Our EC2 instance was supposed to upload logs to an S3 bucket, but suddenly, the Jenkins job started failing with:

âŒ 403 Forbidden â€“ Access Denied

At first, everything looked fine:
âœ… IAM role had s3:PutObject permissions.
âœ… S3 bucket existed, and the policy seemed correct.
âœ… Jenkins pipeline was properly configured.
But stillâ€¦ ACCESS DENIED! ğŸ˜¤

ğŸ” The Debugging Process::

ğŸ›  Step 1: Checked IAM Role Permissions â†’ s3:ListBucket was missing!
ğŸ›  Step 2: Reviewed S3 Bucket Policy â†’ The policy didn't explicitly allow access for the EC2 role.
ğŸ›  Step 3: Examined KMS Encryption â†’ The bucket had KMS encryption, but the IAM role lacked kms:Encrypt and kms:Decrypt permissions.
ğŸ›  Step 4: Tested with AWS CLI â†’ Running aws s3 ls s3://my-bucket confirmed Access Denied.

ğŸ’¡ The Fix::

âœ… Updated the IAM Role Policy to include s3:ListBucket.
âœ… Modified the S3 Bucket Policy to explicitly allow EC2 access.
âœ… Added KMS permissions (kms:Encrypt & kms:Decrypt).
âœ… Retested the Jenkins job...SUCCESS! ğŸ‰

ğŸš€ Key Takeaways

ğŸ”¹ Missing s3:ListBucket can break uploads, even if s3:PutObject is allowed.
ğŸ”¹ KMS encryption requires additional permissionsâ€”don't overlook them!
ğŸ”¹ Debugging with AWS CLI (aws s3 ls, aws s3 cp) helps pinpoint access issues fast.
This issue took hours to debug, but the learnings will last a lifetime! ğŸ’¡
ğŸ’¬ Have you ever spent way longer than expected troubleshooting an AWS permissions issue? Letâ€™s discuss in the comments! ğŸš€
